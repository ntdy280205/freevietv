<!DOCTYPE html> 
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Free Vietnamese TV</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://vjs.zencdn.net/8.5.2/video-js.css" rel="stylesheet" />
  <link href="tv.css?v=1" rel="stylesheet" />
</head>
<body>

  <!-- Player -->
  <div class="player-container" id="playerContainer">
    <video id="my-video" 
           class="video-js vjs-big-play-centered" 
           controls 
           autoplay 
           muted 
           playsinline 
           preload="auto"
           poster="images/tv247_background.png">
      Vui lòng nâng cấp phiên bản trình duyệt hoặc thiết bị để có thể xem chương trình này.
    </video>
  </div>

  <!-- Danh sách kênh -->
  <div class="channel-list" id="channelList">
    <iframe src="channels.html" class="channel-frame" id="channelFrame"></iframe>
  </div>

  <script src="https://vjs.zencdn.net/8.5.2/video.min.js"></script>
  <script>
    const player = videojs('my-video');
    const container = document.getElementById('playerContainer');
    const channelList = document.getElementById('channelList');
    const channelFrame = document.getElementById('channelFrame');

    // Hình chờ mặc định
    container.style.setProperty('--poster', 'url("images/tv247_background.png")');

    // Hàm phát kênh
    function playChannel(src, poster) {
      if (poster) {
        player.poster(poster);
        container.style.setProperty('--poster', `url("${poster}")`);
      }
      player.src({ src, type: 'application/x-mpegURL' });
      player.play();
    }

    // Nhận tin nhắn từ iframe (khi click kênh)
    window.addEventListener("message", e => {
      if (e.data && e.data.src) {
        playChannel(e.data.src, e.data.poster);
      }
    });

    // Khi iframe load xong → phát kênh đầu tiên
    channelFrame.addEventListener("load", () => {
      try {
        const doc = channelFrame.contentDocument || channelFrame.contentWindow.document;
        const firstLink = doc.querySelector(".channel a");
        if (firstLink) {
          playChannel(firstLink.dataset.src, firstLink.dataset.poster);
        } else {
          // fallback nếu không có kênh nào
          playChannel("https://live.fptplay53.net/fnxhd1/vtv1hd_vhls.smil/chunklist_b5000000.m3u8", "images/tv247_background.png");
        }
      } catch (err) {
        console.warn("Không lấy được kênh đầu tiên:", err);
        // fallback nếu lỗi cross-origin
        playChannel("https://live.fptplay53.net/fnxhd1/vtv1hd_vhls.smil/chunklist_b5000000.m3u8", "images/tv247_background.png");
      }
    });

    // Cập nhật kích thước iframe khi có thay đổi trên màn hình
    const updateLayout = () => {
      if (window.innerWidth <= 768) {
        const playerHeight = container.offsetHeight;
        const windowHeight = window.innerHeight;
        const newChannelListHeight = windowHeight - playerHeight;
        channelList.style.height = `${newChannelListHeight}px`;
        channelFrame.style.height = `${newChannelListHeight}px`;
      } else {
        channelList.style.height = '100%';
        channelFrame.style.height = '100%';
      }
    };

    window.addEventListener("load", updateLayout);
    window.addEventListener("resize", updateLayout);
    window.addEventListener("orientationchange", updateLayout);
  </script>
</body>
</html>
